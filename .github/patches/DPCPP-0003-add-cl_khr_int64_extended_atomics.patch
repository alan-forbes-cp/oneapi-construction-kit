From b71db905bd547c56d31f3489f6dcc4e1436239e7 Mon Sep 17 00:00:00 2001
From: PietroGhg <pietro.ghiglio@codeplay.com>
Date: Wed, 19 Jun 2024 14:55:52 +0100
Subject: [PATCH] add cl_khr_int64_extended_atomics

---
 libclc/CMakeLists.txt                        | 2 +-
 libclc/libspirv/lib/generic/atomic/atomic_and.cl | 2 +-
 libclc/libspirv/lib/generic/atomic/atomic_or.cl  | 2 +-
 libclc/libspirv/lib/generic/atomic/atomic_xor.cl | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/libclc/CMakeLists.txt b/libclc/CMakeLists.txt
index 4defe240006f..e073ffaad3b5 100644
--- a/libclc/CMakeLists.txt
+++ b/libclc/CMakeLists.txt
@@ -423,7 +423,7 @@ foreach( t ${LIBCLC_TARGETS_TO_BUILD} )
       "+__opencl_c_images,"
       "+cl_khr_3d_image_writes")
     if( ARCH STREQUAL "aarch64")
-      string( APPEND CL_3_0_EXTENSIONS ",+cl_clang_storage_class_specifiers,+__opencl_c_fp64,+cl_khr_int64_base_atomics" )
+      string( APPEND CL_3_0_EXTENSIONS ",+cl_clang_storage_class_specifiers,+__opencl_c_fp64,+cl_khr_int64_base_atomics,+cl_khr_int64_extended_atomics" )
     endif()
     if( supports_generic_addrspace )
       string( APPEND CL_3_0_EXTENSIONS ",+__opencl_c_generic_address_space" )
diff --git a/libclc/libspirv/lib/generic/atomic/atomic_and.cl b/libclc/libspirv/lib/generic/atomic/atomic_and.cl
index 40cd616cf88a..30eae5ab9300 100644
--- a/libclc/libspirv/lib/generic/atomic/atomic_and.cl
+++ b/libclc/libspirv/lib/generic/atomic/atomic_and.cl
@@ -38,7 +38,7 @@ IMPL(unsigned long, m, local, U3AS3, 1, __sync_fetch_and_and_8)
 IMPL_GENERIC(int, i, __sync_fetch_and_and)
 IMPL_GENERIC(unsigned int, j, __sync_fetch_and_and)
 
-#ifdef cl_khr_int64_base_atomics
+#ifdef cl_khr_int64_extended_atomics
 IMPL_GENERIC(long, l, __sync_fetch_and_and_8)
 IMPL_GENERIC(unsigned long, m, __sync_fetch_and_and_8)
 #endif
diff --git a/libclc/libspirv/lib/generic/atomic/atomic_or.cl b/libclc/libspirv/lib/generic/atomic/atomic_or.cl
index 4161a33d8b6d..81487ac50827 100644
--- a/libclc/libspirv/lib/generic/atomic/atomic_or.cl
+++ b/libclc/libspirv/lib/generic/atomic/atomic_or.cl
@@ -38,7 +38,7 @@ IMPL(unsigned long, m, local, U3AS3, 1, __sync_fetch_and_or_8)
 IMPL_GENERIC(int, i, __sync_fetch_and_or)
 IMPL_GENERIC(unsigned int, j, __sync_fetch_and_or)
 
-#ifdef cl_khr_int64_base_atomics
+#ifdef cl_khr_int64_extended_atomics
 IMPL_GENERIC(long, l, __sync_fetch_and_or_8)
 IMPL_GENERIC(unsigned long, m, __sync_fetch_and_or_8)
 #endif
diff --git a/libclc/libspirv/lib/generic/atomic/atomic_xor.cl b/libclc/libspirv/lib/generic/atomic/atomic_xor.cl
index 428f8f2de1c8..10c676cd91fc 100644
--- a/libclc/libspirv/lib/generic/atomic/atomic_xor.cl
+++ b/libclc/libspirv/lib/generic/atomic/atomic_xor.cl
@@ -38,7 +38,7 @@ IMPL(unsigned long, m, local, U3AS3, 1, __sync_fetch_and_xor_8)
 IMPL_GENERIC(int, i, __sync_fetch_and_xor)
 IMPL_GENERIC(unsigned int, j, __sync_fetch_and_xor)
 
-#ifdef cl_khr_int64_base_atomics
+#ifdef cl_khr_int64_extended_atomics
 IMPL_GENERIC(long, l, __sync_fetch_and_xor_8)
 IMPL_GENERIC(unsigned long, m, __sync_fetch_and_xor_8)
 #endif
-- 
2.43.0

